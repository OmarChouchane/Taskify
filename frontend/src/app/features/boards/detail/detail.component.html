<!-- Breadcrumb Navigation -->
<nav class="board-breadcrumb">
  <a routerLink="/organizations">Organizations</a>
  @if (board()?.organization) {
    <span class="separator">/</span>
    <a [routerLink]="['/organizations', board()?.organization?.id]">{{ board()?.organization?.name }}</a>
  }
  <span class="separator">/</span>
  <span class="current">{{ board()?.name }}</span>
</nav>

<div class="kb-board-header">
  <button
    mat-mini-fab
    [routerLink]="board()?.organization ? ['/organizations', board()?.organization?.id] : ['/organizations']"
    color="secondary"
    aria-label="Back"
  >
    <mat-icon>chevron_left</mat-icon>
  </button>

  <div class="board-title-section">
    <h1 class="kb-board-title">{{ board()?.name }}</h1>
    @if (board()?.organization) {
      <span class="org-tag">{{ board()?.organization?.name }}</span>
    }
  </div>
</div>

<!-- Lists should come from swimlanes for the board -->

<div
  cdkDropListGroup
  cdkDropList
  cdkDropListOrientation="horizontal"
  [cdkDropListDisabled]="!canEdit()"
  (cdkDropListDropped)="onSwimlaneChange($event)"
  class="swimlanes-wrapper"
>
  @for(swimlane of board()?.swimlanes; track swimlane) {
  <div class="swimlane" [class.draggable]="canEdit()" [cdkDragDisabled]="!canEdit()" cdkDrag>
    <div class="swimlane-header" [class.drag-handle]="canEdit()" cdkDragHandle>
      <h2>{{ swimlane.name }}</h2>
      @if (canEdit()) {
        <div>
          <button
            color="secondary"
            mat-stroked-button
            (click)="editSwimlane(swimlane)"
          >
            Edit
          </button>
        </div>
      }
    </div>

    <div class="swimlane-inner">
      <div
        class="swimlane-inner__dragzone"
        cdkDropList
        cdkDropListOrientation="vertical"
        [cdkDropListData]="swimlane.cards"
        [cdkDropListDisabled]="!canEdit()"
        (cdkDropListDropped)="onCardChange($event, swimlane)"
      >
        @for(card of swimlane.cards; track card) {
        <div
          class="swimlane__card"
          (click)="canEdit() ? addOrEditCard(swimlane, card) : null"
          [class.clickable]="canEdit()"
          [cdkDragDisabled]="!canEdit()"
          cdkDrag
        >
          {{ card.name }}
        </div>
        }
      </div>
    </div>
    @if (canEdit()) {
      <button (click)="addOrEditCard(swimlane)" mat-button>Add card</button>
    }
  </div>
  }
  @if (canEdit()) {
    <div class="swimlane">
      <h2>New swimlane</h2>
      <div class="swimlane-inner">
        <form [formGroup]="swimlaneForm">
          <mat-form-field>
            <mat-label>Name</mat-label>
            <input matInput formControlName="name" placeholder="Ex. Todo" />

            @if (swimlaneForm.controls.name.hasError('required')) {
            <mat-error>Name is required</mat-error>
            } </mat-form-field
          ><br />
          <button type="button" (click)="addSwimlane()" color="primary" mat-flat-button>
            Add swimlane
          </button>
        </form>
      </div>
    </div>
  }
</div>

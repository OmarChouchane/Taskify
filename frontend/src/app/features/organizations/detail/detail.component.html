<div class="org-detail-container" *ngIf="!loading && organization">
  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <a routerLink="/organizations">Organizations</a>
    <span class="separator">/</span>
    <span class="current">{{ organization.name }}</span>
  </nav>

  <div class="header">
    <div class="title-section">
      <h1>{{ organization.name }}</h1>
      <p class="description" *ngIf="organization.description">
        {{ organization.description }}
      </p>
    </div>
    <div class="actions" *ngIf="isAdmin">
      <button class="btn btn-outline" (click)="openEditModal()">Edit</button>
      <button class="btn btn-danger" (click)="deleteOrganization()">Delete</button>
    </div>
  </div>

  <!-- Your Role Section -->
  <section class="role-section" *ngIf="myRole">
    <div class="role-card">
      <div class="role-header">
        <span class="role-label">Your Role</span>
        <span class="badge" [ngClass]="'badge-' + myRole">{{ myRole }}</span>
      </div>
      <div class="permissions">
        <ul>
          <li class="permission-item allowed">
            <span class="icon">✓</span> View organization and members
          </li>
          <li class="permission-item" [class.allowed]="myRole === 'admin' || myRole === 'editor'">
            <span class="icon">{{ myRole === 'admin' || myRole === 'editor' ? '✓' : '✗' }}</span>
            Create and edit boards
          </li>
          <li class="permission-item" [class.allowed]="myRole === 'admin'">
            <span class="icon">{{ myRole === 'admin' ? '✓' : '✗' }}</span>
            Manage members and invitations
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Boards Section -->
  <section class="boards-section">
    <div class="section-header">
      <h2>Boards ({{ organization.boards?.length || 0 }})</h2>
      <button class="btn btn-primary" *ngIf="myRole === 'admin' || myRole === 'editor'" (click)="openAddBoardModal()">
        + New Board
      </button>
    </div>

    <div class="boards-grid" *ngIf="organization.boards && organization.boards.length > 0">
      <a *ngFor="let board of organization.boards"
         [routerLink]="['/organizations', organization.id, 'boards', board.id]"
         class="board-card">
        <div class="board-card-header">
          <span class="board-icon"></span>
          <h3>{{ board.name }}</h3>
        </div>
        <div class="board-card-footer">
          <span class="org-tag">{{ organization.name }}</span>
          <span class="swimlane-count">{{ board.swimlanes?.length || 0 }} swimlanes</span>
        </div>
      </a>
    </div>

    <div class="empty-state-sm" *ngIf="!organization.boards || organization.boards.length === 0">
      <p>No boards yet. Create your first board to get started.</p>
    </div>
  </section>

  <div class="content">
    <!-- Members Section -->
    <section class="members-section">
      <div class="section-header">
        <h2>Members ({{ members.length }})</h2>
        <button class="btn btn-outline" *ngIf="isAdmin" (click)="openInviteModal()">
          + Invite Member
        </button>
      </div>

      <div class="members-list">
        <div class="member-card" *ngFor="let member of members">
          <div class="member-info">
            <div class="avatar">
              {{ (member.user.firstName || member.user.email).charAt(0) | uppercase }}
            </div>
            <div class="details">
              <span class="name">
                {{ member.user.firstName }} {{ member.user.lastName }}
              </span>
              <span class="email">{{ member.user.email }}</span>
            </div>
          </div>
          <div class="member-actions">
            <select
              [value]="member.role"
              (change)="updateMemberRole(member, $any($event.target).value)"
              [disabled]="!isAdmin"
              class="role-select"
            >
              <option value="admin">Admin</option>
              <option value="editor">Editor</option>
              <option value="viewer">Viewer</option>
            </select>
            <button
              class="btn btn-ghost btn-icon"
              *ngIf="isAdmin"
              (click)="removeMember(member)"
              title="Remove member"
            >
              ×
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Pending Invitations -->
    <section class="invitations-section" *ngIf="isAdmin && invitations.length > 0">
      <h2>Pending Invitations</h2>
      <div class="invitations-list">
        <div class="invitation-card" *ngFor="let inv of invitations">
          <div class="invitation-info">
            <span class="email">{{ inv.email }}</span>
            <span class="badge" [ngClass]="'badge-' + inv.role">{{ inv.role }}</span>
            <span class="expires">
              Expires: {{ inv.expiresAt | date : 'short' }}
            </span>
          </div>
          <div class="invitation-actions">
            <button class="btn btn-outline btn-sm" (click)="copyInviteLink(inv.code)">
              Copy Link
            </button>
            <button class="btn btn-danger btn-sm" (click)="revokeInvitation(inv)">
              Revoke
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<div class="loading" *ngIf="loading">
  <div class="spinner"></div>
  <span>Loading organization...</span>
</div>

<!-- Invite Modal -->
<div class="modal-overlay" *ngIf="showInviteModal" (click)="closeInviteModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <h2>Invite Member</h2>
    <div class="form-group">
      <label>Email</label>
      <input
        type="email"
        [(ngModel)]="inviteEmail"
        placeholder="user@example.com"
      />
    </div>
    <div class="form-group">
      <label>Role</label>
      <select [(ngModel)]="inviteRole">
        <option value="admin">Admin</option>
        <option value="editor">Editor</option>
        <option value="viewer">Viewer</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" (click)="closeInviteModal()">Cancel</button>
      <button class="btn btn-primary" (click)="sendInvitation()">
        Send Invitation
      </button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <h2>Edit Organization</h2>
    <div class="form-group">
      <label>Name</label>
      <input type="text" [(ngModel)]="editName" />
    </div>
    <div class="form-group">
      <label>Description</label>
      <textarea [(ngModel)]="editDescription" rows="3"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" (click)="closeEditModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveOrganization()">Save</button>
    </div>
  </div>
</div>

<!-- Add Board Modal -->
<div class="modal-overlay" *ngIf="showAddBoardModal" (click)="closeAddBoardModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <h2>Create New Board</h2>
    <div class="form-group">
      <label>Board Name</label>
      <input type="text" [(ngModel)]="newBoardName" placeholder="Enter board name" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" (click)="closeAddBoardModal()">Cancel</button>
      <button class="btn btn-primary" (click)="createBoard()">Create Board</button>
    </div>
  </div>
</div>
